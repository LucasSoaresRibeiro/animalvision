<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Visão Animal</title>
</head>
<body>
    <h1>Visão Animal</h1>
    <button onclick="startCamera()">Iniciar Câmera</button>
    <button onclick="applyDogVision()">Visão de Cachorro</button>
    <button onclick="applyFishVision()">Visão de Peixe</button>
    <button onclick="applyButterflyVision()">Visão de Borboleta</button>
    <button onclick="applyHorseVision()">Visão de Cavalo</button>
    <button onclick="applyBeeVision()">Visão de Abelha</button>
    <button onclick="applyChameleonVision()">Visão de Camaleão</button>
    <button onclick="applySnakeVision()">Visão de Cobra</button>
    <video id="video" width="400" height="300" style="display: none;"></video>
    <canvas id="canvas" width="400" height="300"></canvas>
    
    <script>
        // Variáveis globais
        var videoStream;
        var videoElement = document.getElementById('video');
        var canvasElement = document.getElementById('canvas');
        var canvasContext = canvasElement.getContext('2d');
        var currentFilter = null;

        // Iniciar a câmera do dispositivo móvel
        function startCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function(stream) {
                        videoStream = stream;
                        videoElement.srcObject = stream;
                        videoElement.play();
                        startDrawing();
                    })
                    .catch(function(error) {
                        console.log('Ocorreu um erro ao acessar a câmera: ' + error);
                    });
            }
        }

        // Capturar quadros do vídeo e desenhar no canvas
        function startDrawing() {
            requestAnimationFrame(drawFrame);
        }

        function drawFrame() {
            canvasContext.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
            applyCurrentFilter();
            requestAnimationFrame(drawFrame);
        }

        // Aplicar filtro de visão de cachorro aos quadros
        function applyDogVision() {
            currentFilter = 'dog';
        }

        // Aplicar filtro de visão de peixe aos quadros
        function applyFishVision() {
            currentFilter = 'fish';
        }

        // Aplicar filtro de visão de borboleta aos quadros
        function applyButterflyVision() {
            currentFilter = 'butterfly';
        }

        // Aplicar filtro de visão de cavalo aos quadros
        function applyHorseVision() {
            currentFilter = 'horse';
        }

        // Aplicar filtro de visão de abelha aos quadros
        function applyBeeVision() {
            currentFilter = 'bee';
        }

        // Aplicar filtro de visão de camaleão aos quadros
        function applyChameleonVision() {
            currentFilter = 'chameleon';
        }

        // Aplicar filtro de visão de cobra aos quadros
        function applySnakeVision() {
            currentFilter = 'snake';
        }

        // Aplicar filtro atual aos quadros
        function applyCurrentFilter() {
            var imageData = canvasContext.getImageData(0, 0, canvasElement.width, canvasElement.height);
            var data = imageData.data;

            for (var i = 0; i < data.length; i += 4) {
                var red = data[i];
                var green = data[i + 1];
                var blue = data[i + 2];
                var alpha = data[i + 3];

                // Aplicar filtro de visão de cachorro
                if (currentFilter === 'dog') {
                    var gray = 0.299 * red + 0.587 * green + 0.114 * blue;
                    data[i] = gray;
                    data[i + 1] = gray;
                    data[i + 2] = gray;
                }

                // Aplicar filtro de visão de peixe
                if (currentFilter === 'fish') {
                    var redFish = red;
                    var greenFish = blue;
                    var blueFish = green;
                    data[i] = redFish;
                    data[i + 1] = greenFish;
                    data[i + 2] = blueFish;
                }
                
                // Aplicar filtro de visão de borboleta
                if (currentFilter === 'butterfly') {
                    var redButterfly = green;
                    var greenButterfly = blue;
                    var blueButterfly = red;
                    data[i] = redButterfly;
                    data[i + 1] = greenButterfly;
                    data[i + 2] = blueButterfly;
                }
                
                // Aplicar filtro de visão de cavalo
                if (currentFilter === 'horse') {
                    var redHorse = Math.max(red, green, blue);
                    var greenHorse = Math.min(red, green, blue);
                    var blueHorse = Math.floor((red + green + blue) / 3);

                    // Simular ponto cego dos olhos laterais
                    var centerX = canvasElement.width / 2;
                    var centerY = canvasElement.height / 2;
                    var rectWidth = 40;
                    var rectHeight = 40;
                    var rectX = centerX - rectWidth / 2;
                    var rectY = centerY - rectHeight / 2;

                    if (i % (canvasElement.width * 4) >= rectX && i % (canvasElement.width * 4) <= rectX + rectWidth * 4 &&
                        Math.floor(i / (canvasElement.width * 4)) >= rectY && Math.floor(i / (canvasElement.width * 4)) <= rectY + rectHeight) {
                        data[i] = 0;
                        data[i + 1] = 0;
                        data[i + 2] = 0;
                    } else {
                        data[i] = redHorse;
                        data[i + 1] = greenHorse;
                        data[i + 2] = blueHorse;
                    }
                }
                
                // Aplicar filtro de visão de abelha
                if (currentFilter === 'bee') {
                    var redBee = green;
                    var greenBee = blue;
                    var blueBee = red;
                    data[i] = redBee;
                    data[i + 1] = greenBee;
                    data[i + 2] = blueBee;
                }

                // Aplicar filtro de visão de camaleão
                if (currentFilter === 'chameleon') {
                    var redChameleon = Math.min(red, green, blue);
                    var greenChameleon = Math.max(red, green, blue);
                    var blueChameleon = Math.min(red, green, blue);
                    data[i] = redChameleon;
                    data[i + 1] = greenChameleon;
                    data[i + 2] = blueChameleon;
                }

                // Aplicar filtro de visão de cobra
                if (currentFilter === 'snake') {
                    var redSnake = red;
                    var greenSnake = Math.max(red, green, blue);
                    var blueSnake = blue;
                    data[i] = redSnake;
                    data[i + 1] = greenSnake;
                    data[i + 2] = blueSnake;
                }
            }

            canvasContext.putImageData(imageData, 0, 0);
        }
    </script>
</body>
</html>
